{% extends "layout.html" %}

{% block body %}
 <div class="jumbotron">
        
        <h2>Test #{{test.id}} for {{test.domain}}</h2>
        <br />
        
        <p class="lead">
        	<ol class="progtrckr" data-progtrckr-steps="3">
     <li id="status_1" class="progtrckr-todo">Waiting</li>
     <li id="status_2" class="progtrckr-todo">Processing</li>
     <li id="status_3" class="progtrckr-todo">Finished</li>
    </ol>
            <div id="status"></div>
            <br />
           
        </p>
      <hr />
        <table  class="table table-striped table-bordered" id="cookies" width="100%"><tr><th>Domain</th><th>Name</th><th>Value</th></table>
      </div>

  <script type="text/javascript">
 
 
function set_status(status) {
	switch(status) {
		case 1:
			$('#status_1').attr('class', 'progtrckr-current');
			$('#status_2').attr('class', 'progtrckr-todo');
			$('#status_3').attr('class', 'progtrckr-todo');
			break;
		
		case 2:
			$('#status_1').attr('class', 'progtrckr-done');
			$('#status_2').attr('class', 'progtrckr-current');
			$('#status_3').attr('class', 'progtrckr-todo');
			break;
		
		case 3:
			$('#status_1').attr('class', 'progtrckr-done');
			$('#status_2').attr('class', 'progtrckr-done');
			$('#status_3').attr('class', 'progtrckr-done');
			break;
	}
	
}
function refresh() {
  $.get('/js-test-info/{{test.id}}', function(data) {
    var test = data.test;
    console.log(test);
    
    var status = '';

    switch(test.status) {
      case 1:
        status = "Waiting ...";
        break;
      case 2:
        status = "Processing ...";
        break;

      case 3:
        status = "Finished";
        break;
    }

	set_status(test.status);
    $('#status').html('Started: '+test.datetime[1]+' '+test.datetime[0]+'<br />'+
      'Info: '+test.info+'<br />');



    if(test.status == 3) {
      
      clearInterval(x);

      //get cookies
      $.get('/js-get-cookies/{{test.id}}', function(data) {
        cookies = data.cookies;

        for(c in cookies) {
          c = cookies[c];
          $('#cookies').append('<tr><td>'+c.domain+'</td><td>'+c.name+'</td><td>'+c.value.substring(0,50)+'</td></tr>');
        }
      });
    }
  });
}

var x = setInterval(refresh, 1000);
refresh();
  </script>
{% endblock %}
