{% extends "layout.html" %}

{% block body %}
 <div class="jumbotron">
        
        <h2>Test #{{test.id}} for {{test.domain}}</h2>
        <br />
        
        <p class="lead">
            <div id="status"></div>
            <br />
            <div id="loader"><img src="{{url_for('static', filename='ajax-loader.gif')}}" /></div>
        </p>
      <hr />
        <table  class="table table-striped table-bordered" id="cookies" width="100%"><tr><th>Domain</th><th>Name</th><th>Value</th></table>
      </div>

  <script type="text/javascript">
function refresh() {
  $.get('/js-test-info/{{test.id}}', function(data) {
    var test = data.test;
    console.log(test);
    
    var status = '';

    switch(test.status) {
      case 1:
        status = "Waiting ...";
        break;
      case 2:
        status = "Processing ...";
        break;

      case 3:
        status = "Finished";
        break;
    }

    $('#status').html('Started: '+test.datetime[1]+' '+test.datetime[0]+'<br />Status: '+status+'<br />'+
      'Info: '+test.info+'<br />');



    if(test.status == 3) {
      $('#loader').hide();
      clearInterval(x);

      //get cookies
      $.get('/js-get-cookies/{{test.id}}', function(data) {
        cookies = data.cookies;

        for(c in cookies) {
          c = cookies[c];
          $('#cookies').append('<tr><td>'+c.domain+'</td><td>'+c.name+'</td><td>'+c.value.substring(0,50)+'</td></tr>');
        }
      });
    }
  });
}

var x = setInterval(refresh, 1000);
refresh();
  </script>
{% endblock %}
